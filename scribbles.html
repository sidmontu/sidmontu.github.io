<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Siddhartha - Projects</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/blog.css" rel="stylesheet">

  </head>

  <body>

    <!--<div class="blog-masthead">
      <div class="container">
        <nav class="blog-nav">
          <a class="blog-nav-item" href="index.html">Home</a>
          <a class="blog-nav-item" href="pubs.html">Publications</a>
          <a class="blog-nav-item" href="projects.html">Projects</a>
          <a class="blog-nav-item" href="music.html">Music</a>
          <a class="blog-nav-item active" href="blog.html">Tech Toch</a>
        </nav>
      </div>
    </div>-->

    <nav class="navbar navbar-default navbar-inverse" role="navigation">
	   	<div class="container-fluid" id="navfluid">
	    	<div class="navbar-header">
	        	<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navigationbar">
	            	<span class="sr-only">Toggle navigation</span>
	            	<span class="icon-bar"></span>
	            	<span class="icon-bar"></span>
	            	<span class="icon-bar"></span>
	            </button>
	            <a class="navbar-brand" href="index.html">Siddhartha</a>
	       	</div>
	       	<div class="collapse navbar-collapse" id="navigationbar">
	           	<ul class="nav navbar-nav">	               	
	               	<li><a class="blog-nav-item" href="index.html">Home</a></li>
			        <li><a class="blog-nav-item" href="pubs.html">Publications</a></li>
			        <li><a class="blog-nav-item" href="blog.html">Blog</a></li>
			        <li><a class="blog-nav-item" href="music.html">Music</a></li>
			        <li class="active"><a class="blog-nav-item active" href="scribbles.html">Scribbles</a></li>
	           	</ul>
	      	</div><!-- /.navbar-collapse -->
	   	</div><!-- /.container-fluid -->
	</nav>

    <div class="container">

      <div class="blog-header">
        <h1 class="blog-title">Scribbles</h1>
        <p class="lead blog-description">Quick cheatsheet/notes on small things that don't really deserve a long writeup.</p>
      </div>

      <h3>Xilinx Tools</h3>
      <p>For some obscure reason, if Xilinx tools (e.g. Vivado) is in your $PATH, some C/C++ projects report build errors - I observed this error from trying to build Ettus RFNoC framework using PyBOMBs. Removing Xilinx tools from the $PATH in a fresh terminal does the trick.</p>

      <br>

      <h3>Tensorpack custom DataFlow class</h3>
      <p>If you have a very large dataset that is dynamically-loaded from disk - i.e. if you keep track of pointers in your get_data() routine to yield data to the trainer at runtime, remember to reset these pointers appropriately at the beginning of the get_data() routine. This is because Tensorpack spawns multiple threads for feeding the Tensorpack trainer at runtime, and without a "reset_state()" function will cause out-of-range memory access errors.</p>

      <h3>Xilinx pblocks</h3>
      <p>Pblock is a physical block to constrain nets to physical areas on the FPGA. Pblocks can be nested, but Xilinx recommend at most one-level of nesting, and to avoid it altogether if possible. Pblock can be shaped into custom shapes (instead of just a rectangle) by clicking on the "add pblock rectangle" option when selecting the pblock you wish to reshape. The pblock properties can be exported to a xdc constraints file automatically using "save constraints as" option under "File". These constraints are basically tcl commands that look something like the following:</p>
      <p style="border:3px; border-style:solid; border-color:#000000; padding: 1em;">
        create_pblock "name you wish to give to the pblock"<br>
        add_cells_to_pblock [get_pblocks "name of pblock"] [get_cells -quiet [list "name of module you wish to assign to pblock"]<br>
        resize_pblock [get_pblocks "name of pblock"] -add {SLICE_"XY-COORD":SLICE_"XY-COORD"}<br>
        resize_pblock [get_pblocks "name of pblock"] -add {DSP48_"XY-COORD":DSP48_"XY-COORD"}<br>
        resize_pblock [get_pblocks "name of pblock"] -add {RAMB18_"XY-COORD":RAMB18_"XY-COORD"}<br>
        resize_pblock [get_pblocks "name of pblock"] -add {RAMB36_"XY-COORD":RAMB36_"XY-COORD"}<br>
      </p>
      <p>You can do a DRC check for floorplanning to make sure pblock specified for the module meets expectations. Basically, this is a sanity test.</p>
      <p>Vivado has an auto-floorplanning tool as well (under Tools - Floorplanning - Auto-create Pblocks). Also worth checking out "Window - Phyiscal Constraints" tab, which will show connectivity between different Pblocks for better visualization of dataflow in your circuit. Individual logic can also be locked into exact locations so that there is consistency between runs (i.e. you don't get a completely different placed/routed solution that you can't quantify whether your changes made any difference between implementation runs).</p>
      <p>Floorplanning can improve performance and consistency between runs. Some guidelines: floorplan what is necessary, do not over-floorplan. Choose modules to floor-plan that do not have connectivity to lots of other modules, as those modules are better to be broken apart to reduce critical path lengths. Use RTL hierarchy, DRC checks, properties and other Vivado tools to judge what is best and how to floorplan. Finally, floorplanning can be an iterative process.</p>
      <p>Reference resource: <a href="https://www.xilinx.com/video/hardware/design-analysis-floorplanning-with-vivado.html">https://www.xilinx.com/video/hardware/design-analysis-floorplanning-with-vivado.html</a></p>

      <h3>Arch Linux + bspwm + sxhkd</h3>
      <p>Weird thing I found that if, instead of using urxvt as the main terminal, you are using termite, then there is a weird idiosyncrasy with how a bspc rule has to be declared. In fact, it seems like urxvt also has an oddity from a stackoverflow post that I saw</p>
      <p>Instead of :</p>
      <p style="border:3px; border-style:solid; border-color=#000000; padding: 1em;">
        bspc rule -a termite state=floating<br>
        bspc rule -a urxvt state=floating
      </p>
      <p>You must declare the following (basically the capitalization) :</p>
      <p style="border:3px; border-style:solid; border-color=#000000; padding: 1em;">
        bspc rule -a Termite state=floating<br>
        bspc rule -a URxvt state=floating
      </p>
      <p>for the rule to register when creating the window. By the way, what's with the weird names (sxhkd, urxvt)?</p>
      <p><font color="#FF0000">Problems:</font> panel does not launch automatically on startx.</p>
      
      <h3>Custom IP on Pynq</h3>
      <p>Tested with Vivado(HLS) 2017.4</p>
      <p>For reference: <a href="https://www.youtube.com/watch?v=Dupyek4NUoI">https://www.youtube.com/watch?v=Dupyek4NUoI</a></p>
      <p>For reference: Pynq-Z1 board part number is xc7z020clg400-1</p>
      <p>For reference: Pynq-Z1 board files from: <a href="https://github.com/cathalmccabe/pynq-z1_board_files">https://github.com/cathalmccabe/pynq-z1_board_files</a> (installation instructions in the .md file in repo)</p>
      <p>Steps (roughly) :</p>
      <p style="border:3px; border-style:solid; border-color=#000000; padding: 1em;">
      1) Easiest way is to start with VivadoHLS, write your own HLS module that interfaces with the host CPU. Add HLS INTERFACE pragmas to define the I/O ports and their types. e.g. #pragma HLS INTERFACE s_axilite port=<port_name>. You can choose axi, s_axilite, axis for port type (as far as I know for now). Also add #pragma HLS INTERFACE ap_ctrl_none port=return to turn off function call handshake, which creates a whole bunch of extra ports like ap_start, ap_done, ap_idle, and ap_ready, which might not be required. See <a href="https://www.xilinx.com/support/answers/55279.html">https://www.xilinx.com/support/answers/55279.html</a> for more info.<br>
      2) Run C synthesis, make sure there are no errors and you understand the warnings.<br>
      3) Click button for "Export RTL". We can use default settings and click ok. This will package your design as an IP. Choose the language you prefer as well (I go with Verilog mostly).<br>
      4) This is the first interesting part to pay attention to: Under "solution1" folder (assuming you're using the default solution name for Vivado synthesis process), go to impl>misc>drivers>"your ip name">src and open x"ip name"_hw.h. Make a note of all the addresses of each register that is being assigned to your ports. You'll need this later to be able to write your software Python drivers that send data to these memory-mapped AXI ports.<br>
      5) Switch over to Vivado.

      <h3>AXI-STREAM interface on Pynq (with DMA)</h3>
      <p>Obscure artifact #1: Interrupts from AXI DMA block have to be handled by an AXI Interrupt controller, instead of simply concat into IRQ_F2P port of Zynq-PS. See <a href="https://forums.xilinx.com/t5/Embedded-Linux/A-key-error-when-I-am-trying-to-access-a-DMA-IP-on-PYNQ-Z1-board/td-p/847817">https://forums.xilinx.com/t5/Embedded-Linux/A-key-error-when-I-am-trying-to-access-a-DMA-IP-on-PYNQ-Z1-board/td-p/847817</a></p>

    </div><!-- /.container -->

    <footer class="blog-footer">
      <p>Blog template built for <a href="http://getbootstrap.com" target="_blank">Bootstrap</a> by <a href="https://twitter.com/mdo" target="_blank">@mdo</a>.</p>
      <p>
        <a href="#">Back to top</a>
      </p>
    </footer>


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="js/script.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    </body>
</html>
